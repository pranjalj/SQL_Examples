Select dm1.emp_no, d.dept_name FROM dept_manager as dm1 INNER JOIN (SELECT d.dept_name, d.dept_no, dm2.time FROM departments as d INNER JOIN (SELECT dm.dept_no, MIN(-1*(dm.to_date - dm.from_date)) as time FROM (SELECT from_date, to_date, dept_no FROM dept_manager WHERE YEAR(to_date) < 9999) as dm GROUP BY dept_no) as dm2 ON dm2.dept_no = d.dept_no) as d ON (-1*d.time) = (dm1.to_date - dm1.from_date) AND d.dept_no = dm1.dept_no ORDER BY dm1.emp_no;
